# =================================================================
# CONFIGURACIÓN DE LA APLICACIÓN USIV PDF SERVICE
# =================================================================

# Información de la aplicación
spring.application.name=usiv-pdf-service
spring.profiles.active=dev

# =================================================================
# CONFIGURACIÓN DEL SERVIDOR
# =================================================================
server.port=8080
server.servlet.context-path=/usiv-pdf
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# Configuración de compresión
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# Configuración de timeout
server.tomcat.connection-timeout=20000
server.tomcat.max-connections=8192
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10

# =================================================================
# CONFIGURACIÓN DE LOGGING
# =================================================================
logging.level.root=INFO
logging.level.com.usiv=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.web=INFO

# Configuración de archivos de log
logging.file.name=logs/usiv-pdf-service.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# =================================================================
# CONFIGURACIÓN DE SEGURIDAD JWT
# =================================================================
# Clave secreta para JWT (cambiar en producción)
jwt.secret=mySecretKey123456789012345678901234567890
jwt.expiration=86400000
jwt.download-expiration=3600000

# Configuración de CORS
cors.allowed-origins=http://localhost:3000,http://localhost:8080,https://usiv.cl
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true

# =================================================================
# CONFIGURACIÓN DE ALMACENAMIENTO DE ARCHIVOS
# =================================================================
# Ruta base para almacenamiento de PDFs
file.storage.base-path=./storage/pdfs
file.storage.trash-path=./storage/trash
file.storage.temp-path=./storage/temp

# URL base para descargas
file.download.base-url=http://localhost:8080/usiv-pdf/api/download
file.download.public-url=http://localhost:8080/usiv-pdf/public/download

# Configuración de limpieza automática
file.cleanup.enabled=true
file.cleanup.retention-months=6
file.cleanup.trash-retention-days=30
file.cleanup.schedule=0 0 2 * * ?

# Tamaño máximo de archivos
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB

# =================================================================
# CONFIGURACIÓN DE PDF
# =================================================================
# Configuración de firma digital
pdf.signature.enabled=true
pdf.signature.keystore-path=certificates/signer.p12
pdf.signature.keystore-password=changeit
pdf.signature.key-alias=usiv-signer
pdf.signature.reason=Documento generado por USIV
pdf.signature.location=Chile

# Configuración de QR
qr.enabled=true
qr.size=150
qr.margin=1
qr.error-correction=M

# Configuración de logo
pdf.logo.enabled=true
pdf.logo.path=images/logo.png
pdf.logo.width=100
pdf.logo.height=50

# =================================================================
# CONFIGURACIÓN DE SWAGGER/OPENAPI
# =================================================================
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha

# =================================================================
# CONFIGURACIÓN DE ACTUATOR
# =================================================================
management.endpoints.web.exposure.include=health,info,metrics,env
management.endpoint.health.show-details=when-authorized
management.info.env.enabled=true

# Información de la aplicación para Actuator
info.app.name=USIV PDF Service
info.app.description=Servicio de generación y firma de documentos PDF
info.app.version=1.0.0
info.app.encoding=UTF-8
info.app.java.version=${java.version}

# =================================================================
# CONFIGURACIÓN DE VALIDACIÓN
# =================================================================
# Configuración de validación de entrada
validation.rut.enabled=true
validation.rut.format=^[0-9]{7,8}-[0-9Kk]$
validation.license.format=^[A-Z]{1,2}[0-9]{6,8}$
validation.coordinates.precision=6

# =================================================================
# CONFIGURACIÓN DE CACHE
# =================================================================
spring.cache.type=simple
spring.cache.cache-names=qr-codes,file-metadata
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=1h

# =================================================================
# CONFIGURACIÓN DE PROGRAMACIÓN DE TAREAS
# =================================================================
spring.task.scheduling.pool.size=2
spring.task.execution.pool.core-size=2
spring.task.execution.pool.max-size=4
spring.task.execution.pool.queue-capacity=100

# =================================================================
# CONFIGURACIÓN DE DESARROLLO
# =================================================================
# Solo para desarrollo - deshabilitar en producción
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true

# =================================================================
# CONFIGURACIÓN ESPECÍFICA POR PERFIL
# =================================================================

# Configuración para perfil de desarrollo
---
spring.config.activate.on-profile=dev

# Base de datos H2 para desarrollo (opcional)
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# Configuración de desarrollo
file.storage.base-path=./dev-storage/pdfs
file.storage.trash-path=./dev-storage/trash
file.download.base-url=http://localhost:8080/usiv-pdf/api/download
file.download.public-url=http://localhost:8080/usiv-pdf/public/download

# JWT para desarrollo
jwt.secret=devSecretKey123456789012345678901234567890

# Logging más detallado en desarrollo
logging.level.com.usiv=TRACE
logging.level.org.springframework.security=TRACE

---
spring.config.activate.on-profile=prod

# Configuración de producción
server.port=8443
server.ssl.enabled=true
server.ssl.key-store=certificates/keystore.p12
server.ssl.key-store-password=${SSL_KEYSTORE_PASSWORD}
server.ssl.key-store-type=PKCS12
server.ssl.key-alias=usiv-ssl

# Almacenamiento en producción
file.storage.base-path=${PDF_STORAGE_PATH:/opt/usiv/storage/pdfs}
file.storage.trash-path=${PDF_TRASH_PATH:/opt/usiv/storage/trash}
file.download.base-url=${PDF_DOWNLOAD_URL:https://usiv.cl/pdf/api/download}
file.download.public-url=${PDF_PUBLIC_URL:https://usiv.cl/pdf/public/download}

# JWT en producción (usar variables de entorno)
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:86400000}

# Logging en producción
logging.level.root=WARN
logging.level.com.usiv=INFO
logging.file.name=${LOG_PATH:/opt/usiv/logs}/usiv-pdf-service.log

# Deshabilitar herramientas de desarrollo
spring.devtools.restart.enabled=false
spring.devtools.livereload.enabled=false
springdoc.swagger-ui.enabled=false

# Configuración de seguridad adicional
server.tomcat.remoteip.remote-ip-header=x-forwarded-for
server.tomcat.remoteip.protocol-header=x-forwarded-proto
server.forward-headers-strategy=native

---
spring.config.activate.on-profile=test

# Configuración para pruebas
file.storage.base-path=./test-storage/pdfs
file.storage.trash-path=./test-storage/trash
file.cleanup.enabled=false

# JWT para pruebas
jwt.secret=testSecretKey123456789012345678901234567890
jwt.expiration=3600000

# Logging para pruebas
logging.level.root=ERROR
logging.level.com.usiv=DEBUG